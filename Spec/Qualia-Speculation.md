# Qualia: 채팅 UI를 활용한 비쥬얼 노벨 롤플레잉 앱 기획서

## 1. 개요 (Summary)
*   **제품명**: Qualia
*   **플랫폼**: Desktop, iOS, Android, Web (크로스 플랫폼 배포)
*   **핵심 컨셉**: LLM 기반의 에이전트들과 상호작용하며 진행되는 몰입형 비쥬얼 노벨 롤플레잉 게임. 채팅 UI를 기반으로 하며, 실시간 이미지 생성(SDXL) 기능을 통해 시각적 몰입감을 극대화함.

## 2. UX/UI 상세 (UX Description)

### 2.1 탭 구성
앱은 크게 두 가지 탭으로 구성됩니다.
1.  **채팅 (Chat)**
2.  **설정 (Settings)**

### 2.2 채팅 탭 (Chat Tab)
*   **메인 화면 (Empty State)**:
    *   진행 중인 채팅 세션이 없을 경우, 사용자가 새로운 시작을 할 수 있도록 안내 문구를 표시합니다.
*   **새 세션 생성 (+ 버튼)**:
    *   **커스텀 시작**: 파트너(Partner) 페르소나, 유저(User) 페르소나, 초기 상황(Situation)을 직접 설정하여 시작.
    *   **AI 가챠 시작**: AI(LLM)가 임의의 설정과 시나리오를 생성하여 즉시 시작하는 기능.
*   **채팅 인터페이스**:
    *   **디자인**: iPhone iMessage 스타일의 깔끔하고 친숙한 디자인 차용.
    *   **진행 방식**:
        1.  **초기 진입**: 파트너 응답 → 시나리오 감독(Scenario Director) 서술 → (Optional) 비쥬얼 감독(Visual Director) 이미지 생성 → 유저(User) 응답 대기.
        2.  **유저 턴**:
            *   LLM이 현재 상황에 맞는 3~4개의 대사/행동 선택지를 제안.
            *   유저는 선택지를 고르거나, 직접 텍스트를 입력하여 진행 가능.
        3.  **순환**: 유저의 입력 → 파트너 반응 & 시나리오 진행 → 이미지 생성 → 다시 유저 턴.

### 2.3 설정 탭 (Settings Tab)
*   **ComfyUI 설정**:
    *   **연동 방식**: 유저의 로컬 컴퓨터에서 구동되는 ComfyUI 서버(Localhost Port)와 통신.
    *   **제어 패널**: 모델(Model), VAE, 업스케일링(Upscaling), CFG Scale 등 이미지 생성 관련 핵심 파라미터를 앱 내에서 직접 설정.
    *   **UX**: 각 설정 필드에 대한 친절한 설명(Tooltip/Text) 제공.
*   **LLM 설정**:
    *   **API 연동**: OpenRouter API Key 입력 지원.
    *   **모델 선택**: 사용 가능한 LLM 모델 리스트를 불러와 선택 가능.
    *   **에이전트별 설정**: Partner, User, Scenario Director, Visual Director 등 각 역할(Agent)별로 적합한 LLM 모델을 개별 할당 및 설정 가능.
*   **Support**:
    *   **후원 기능**: 'Buy Me a Coffee' 등 개발자 후원 링크 연동.

## 3. 핵심 기능 및 로직 (Core Mechanics)

### 3.1 채팅 경험 (Chat Experience)
*   **실제감 부여 (Realism)**:
    *   실제 사람과 메신저를 하는 듯한 경험 제공.
    *   파트너가 입력 중일 때 '...' 말풍선 애니메이션 표시.
*   **에러 핸들링**:
    *   응답 실패 시 고정 멘트 출력: *"잘 못 들었어. 다시 말해줄래..?"* (API Error로 인지).
    *   사용자가 보낸 마지막 말풍선에 '다시 보내기(Retry)' 버튼 활성화.
*   **파트너 응답 포맷**:
    *   한 번의 턴에 여러 개의 말풍선과 속마음, 행동 지문을 포함.
    *   **구조**:
        *   `행동 지문` (Action)
        *   `대사 1` (Dialogue)
        *   `대사 2` (Optional)
        *   `대사 3` (Optional)
        *   `속마음` (Inner Thought - 유저에게는 보이지 않거나 특정 방식으로 연출 가능)
*   **기억 시스템 (Memory)**:
    *   파트너는 유저와의 대화 중 중요한 내용을 요약하여 장기 기억(Memory)으로 저장 및 유지.

### 3.2 시나리오 디렉터 (Scenario Director - The Writer)
*   **역할**: 제3자 입장에서 상황을 서술하는 '작가' 혹은 '신'의 역할.
*   **기능**:
    *   단순 대화의 나열이 아닌, 비쥬얼 노벨/소설처럼 분위기, 상황, 주변 환경을 서술.
    *   Partner와 User의 대사 외에, 시간의 흐름, 장소 이동, 외부 이벤트 등을 통제하고 서술함.
    *   **목적**: 플롯의 신선함, 카타르시스 제공, 사용자의 몰입과 흥분을 유도(NSFW 포함)하는 중독성 있는 전개 생성.

### 3.3 비쥬얼 디렉터 (Visual Director - The Camera)
*   **역할**: 현재 상황을 시각화하는 '카메라 감독'.
*   **작동 시점**: 시나리오 디렉터의 서술이 끝난 후, 이미지 생성이 필요한 극적 순간이라고 판단될 때 개입.
*   **프로세스**:
    1.  User의 선택/행동 분석.
    2.  Partner의 리액션 분석.
    3.  World State(시간, Partner의 장소 등) 분석.
    4.  위 정보를 종합하여 SDXL 프롬프트(Prompt) 작성 (Danbooru 태그 스타일 등 프로급 튜닝).
    5.  사용자 몰입도(Addiction)와 흥분도 강화를 최우선으로 함.
        *   User 성별/성향에 맞춘 최적의 앵글, 구도, 체위, 연출 적용.
    6.  ComfyUI를 통해 이미지 생성 후 채팅방에 전송.

### 3.4 유저 추론 (User Inference)
*   **역할**: 유저가 다음에 할법한 행동과 대사를 LLM이 미리 추론하여 제안.
*   **기능**:
    *   이미지 생성 및 파트너 응답 직후, 유저가 선택할 수 있는 3~4개의 선택지 생성.
    *   유저는 이를 클릭하여 편하게 진행하거나, 직접 타이핑하여 자유도를 행사.

## 4. 에이전트 정의 (Agent Definitions)

### 4.1 Partner (The Heroine/Hero)
*   사용자가 상호작용하고 공략하는 대상.
*   감정(Emotion) 축 보유.
*   외모(Face, Hair, Body), 어투(Tone), 성격(Personality) 정의됨.

### 4.2 User (The Protagonist)
*   사용자가 해당 세션에서 빙의하는 페르소나.
*   감정 축 없음 (유저 본인이 느끼는 것이므로).
*   외모, 어투, 성격 정의 가능.
*   비쥬얼 노벨/동인지 등에서 독자가 이입하여 특정 목적을 달성하려는 주체.

### 4.3 Scenario Director (The Narrator/God)
*   턴제 대화(Partner ↔ User) 사이의 빈틈을 메우는 서술자.
*   대화만으로 부족한 상황 묘사, 시공간 변경, 강제 이벤트 삽입 수행.
*   유저를 몰입시키고 도파민을 자극하는 플롯 설계를 최우선으로 함 (NSFW 요소 포함).

### 4.4 Visual Director (The Illustrator)
*   시나리오, 대사, 상황을 조합하여 최적의 '한 장면'을 포착.
*   SDXL / Danbooru 태그 생성에 특화됨.
*   단순 묘사가 아닌, 사용자가 보고 싶어하는 '꼴리는' 혹은 '멋진' 포인트(Fetish/Cool factor)를 정확히 짚어내어 이미지로 구현.
