# New Session Creation View Specification

> **Version**: 1.0  
> **Last Updated**: 2026-01-11

## 개요

새로운 채팅 세션을 생성하는 플로우. AI 가챠 시스템.

## UI 플로우

```
1. Model Preset 선택
   ↓
2. Partner 성별 선택
   ↓
3. Generate 버튼
   ↓
4. 로딩 (Scenario Generator 실행)
   ↓
5. 결과 확인 화면
   ↓
6. 세션 시작 or 재생성
```

---

## 화면 구성

### Step 1: Model Preset 선택

```
┌─────────────────────────────────────────┐
│  ← 뒤로        새 세션 만들기             │
├─────────────────────────────────────────┤
│                                         │
│  모델 프리셋을 선택하세요                 │
│                                         │
│  ┌───────────────────────────────────┐ │
│  │ 📷 Realistic Style                │ │
│  │ SDXL Category                     │ │
│  │ Photorealistic, detailed          │ │
│  └───────────────────────────────────┘ │
│                                         │
│  ┌───────────────────────────────────┐ │
│  │ 📷 Anime Style                    │ │
│  │ SDXL Category                     │ │
│  │ Anime coloring, aesthetic         │ │
│  └───────────────────────────────────┘ │
│                                         │
│  ┌───────────────────────────────────┐ │
│  │ 📷 Semi-Realistic (Pony)          │ │
│  │ Pony Category                     │ │
│  │ Score-based prompting             │ │
│  └───────────────────────────────────┘ │
│                                         │
│                    [다음 →]             │
└─────────────────────────────────────────┘
```

**데이터**:
- 사용 가능한 `ComfyUIModelPreset` 목록
- 카테고리별 그룹화 (SDXL, Pony, Flux)

---

### Step 2: Partner 성별 선택

```
┌─────────────────────────────────────────┐
│  ← 뒤로        새 세션 만들기             │
├─────────────────────────────────────────┤
│                                         │
│  파트너 성별을 선택하세요                 │
│                                         │
│  ┌─────────────────┐ ┌───────────────┐ │
│  │                 │ │               │ │
│  │      👩         │ │      👨       │ │
│  │                 │ │               │ │
│  │     Female      │ │     Male      │ │
│  │                 │ │               │ │
│  └─────────────────┘ └───────────────┘ │
│                                         │
│  ┌─────────────────┐ ┌───────────────┐ │
│  │                 │ │               │ │
│  │      ⚧️         │ │      🎲       │ │
│  │                 │ │               │ │
│  │     Other       │ │    Random     │ │
│  │                 │ │               │ │
│  └─────────────────┘ └───────────────┘ │
│                                         │
│                    [생성하기 🎲]         │
└─────────────────────────────────────────┘
```

---

### Step 3: 로딩 화면

```
┌─────────────────────────────────────────┐
│          새 세션 생성 중...              │
├─────────────────────────────────────────┤
│                                         │
│              🎲                         │
│                                         │
│         파트너를 찾는 중...              │
│                                         │
│         ████████░░░░ 75%                │
│                                         │
│                                         │
│   어떤 파트너를 만나게 될까요?           │
│                                         │
└─────────────────────────────────────────┘
```

**애니메이션**:
- 주사위 회전
- 프로그레스 바
- 랜덤 텍스트 ("매력적인 파트너 생성 중...", "흥미로운 상황 설정 중...")

---

### Step 4: 결과 확인 화면

```
┌─────────────────────────────────────────┐
│  ✨ 새로운 파트너를 만났습니다!           │
├─────────────────────────────────────────┤
│                                         │
│  ┌───────────────────────────────────┐ │
│  │                                   │ │
│  │     [Partner 이미지 미리보기]      │ │
│  │                                   │ │
│  └───────────────────────────────────┘ │
│                                         │
│  사쿠라, 22세                            │
│  대학생                                  │
│                                         │
│  성격: INFP, 내향적, 감성적              │
│                                         │
│  ─────────────────────────────────────  │
│                                         │
│  "당신은 도서관에서 책을 찾다가          │
│   우연히 사쿠라와 같은 책을 집으려다      │
│   손이 마주쳤다..."                      │
│                                         │
│  ─────────────────────────────────────  │
│                                         │
│  장르: Pure Romance                     │
│                                         │
│  [🔄 다시 뽑기]      [✅ 시작하기]      │
└─────────────────────────────────────────┘
```

**표시 정보**:
- Partner 이미지 (첫 생성)
- 이름, 나이, 직업
- 성격 요약
- 초기 상황 (initialSituation)
- 장르

**액션**:
- **다시 뽑기**: 같은 설정으로 재생성
- **시작하기**: 채팅 화면으로 이동

---

## 데이터 모델

```dart
class NewSessionState {
  ComfyUIModelPreset? selectedPreset;
  String? partnerGender;
  bool isGenerating;
  GeneratedScenario? result;
}

class GeneratedScenario {
  PartnerProfile partner;
  UserProfile user;
  WorldState worldState;
  String initialSituation;
  String suggestedGenre;
  String? firstImageUrl;  // 첫 이미지 생성 결과
}
```

---

## 상태 관리

### 로딩 상태
- Scenario Generator 호출 중
- 첫 이미지 생성 중 (Visual Director)
- 예상 시간: 10-30초

### 에러 상태
```
┌─────────────────────────────────────────┐
│              ⚠️                         │
│                                         │
│        생성에 실패했습니다               │
│                                         │
│     다시 시도하거나 설정을 변경하세요     │
│                                         │
│          [🔄 다시 시도]                 │
└─────────────────────────────────────────┘
```

---

## 애니메이션

### 가챠 연출
1. **주사위 회전**: 생성 시작
2. **반짝임 효과**: 결과 등장
3. **슬라이드 인**: 파트너 정보 표시
4. **이미지 페이드 인**: 첫 이미지 로드

### 트랜지션
- Step 간 슬라이드 애니메이션
- 결과 화면 → 채팅 화면: 부드러운 전환

---

## 접근성

- **VoiceOver/TalkBack**: 모든 단계 설명
- **다크 모드**: 자동 지원
- **뒤로 가기**: 각 단계에서 이전으로 복귀 가능

---

## 변경 이력

| 날짜 | 변경 내용 |
|---|---|
| 2026-01-11 | 초안 작성: 새 세션 생성 플로우 UI 스펙 |
